<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>EPUB Reader Test (Fixed)</title>
  <script src="https://cdn.jsdelivr.net/npm/epubjs@0.3.93/dist/epub.min.js"></script>
  <style>
    body{background:#0d0d0f;color:#f5f5dc;font-family:serif;margin:0;padding:2rem}
    #viewer{width:80vw;height:80vh;margin:auto;background:#111;border-radius:10px;overflow:auto}
  </style>
</head>
<body>
  <input id="file" type="file" accept=".epub">
  <div id="viewer"></div>

  <script>
    const file = document.getElementById('file');
    const viewer = document.getElementById('viewer');

    file.onchange = async () => {
      const f = file.files[0];
      if(!f) return;

      viewer.innerHTML = 'Loading EPUB...';

      try {
        // Read as ArrayBuffer and pass directly
        const buffer = await f.arrayBuffer();
        const book = ePub(buffer);
        const rendition = book.renderTo(viewer, {
          width: "100%",
          height: "100%",
          flow: "scrolled"
        });

        rendition.themes.default({
          body: {
            background: "#111",
            color: "#f5f5dc",
            "font-family": "serif",
            "line-height": "1.8"
          }
        });

        await rendition.display();
      } catch(err) {
        console.error('Error:', err);
        viewer.innerHTML = 'Failed to load EPUB.';
      }
    };
  </script>
</body>
</html>
