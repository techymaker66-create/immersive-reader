<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>EPUB.js Reader Minimal Test</title>
<script src="https://cdn.jsdelivr.net/npm/epubjs@0.3.93/dist/epub.min.js"></script>
<style>
body { background: #101010; color: #f5f5dc; font-family: 'Playfair Display', serif; }
#viewer { width: 800px; max-width: 98vw; height: 80vh; margin: 2em auto; background: #222; border-radius: 16px; box-shadow: 0 4px 36px #0006; overflow:auto; padding:30px;}
#upload { margin: 2em auto; display: block; }
</style>
</head>
<body>
<input type="file" id="upload" accept=".epub">
<div id="viewer"></div>
<script>
let book, rendition;
document.getElementById('upload').addEventListener('change', function(e){
  const file = e.target.files[0];
  if(!file) return;
  const blobUrl = URL.createObjectURL(file);
  document.getElementById('viewer').innerHTML = '';
  book = ePub({ replacements: 'blobUrl', url: blobUrl });
  rendition = book.renderTo("viewer", {
    width: "100%",
    height: "100%",
    flow: "scrolled",
    manager: "continuous"
  });
  rendition.themes.default({
    'body': { color: '#f5f5dc', background: 'transparent', fontFamily: 'Playfair Display, serif', lineHeight: '2' },
    'p': { fontSize: '20px' }
  });
  book.ready.then(() => {
    rendition.display().then(() => {
      setTimeout(() => {
        if(document.getElementById('viewer').innerText.trim().length === 0) {
          alert('No text rendered. This is likely a broken EPUB or a JavaScript problem.');
        }
      }, 1200);
    });
  });
  rendition.on('rendered', section => {
    const doc = section.document || section.documentElement;
    if(doc && doc.body) {
      console.log('Rendered HTML:', doc.body.innerHTML);
    }
  });
});
</script>
</body>
</html>
